# ZMAP：快速Internet扫描及其安全应用

随着对Internet研究的不断深入，更多的研究开始深入到了对整个互联网空间的探测，以更好的研究分析互联网的运行情况。然而，互联网的IPv4地址空间大小为232，若按传统的TCP SYN等同步扫描方式，需要花费数月的时间。同时，其扫描数据也因周期较长，并不能很好的反映网络实时情况。

美国密歇根大学的Zakir Durumeric、Eric Wustrow和J. Alex Halderman在USENIX发表了题为“ZMap: Fast Internet-Wide Scanning and its Security Applications”，借鉴了SYN Cookies的设计思想，提出了异步的互联网扫描方法，并实现了开源的互联网扫描工具ZMAP，可以在一台千兆主机上45分钟内完成对Internet的特定端口扫描。

ZMAP的主要核心设计思想在于：
1. 异步扫描，无需保存扫描连接状态，因此无需超时等待和重传：借鉴SYN Cookies的方法，将扫描连接信息计算MAC值封装到TCP的SYN序列号和源端口等字段中，直接线速发送，并不在本地维护TCP的连接状态，并进行超时等待。当探测包的响应返回时，从数据包中提取出目的端口和ACK序列号等字段，就可以计算出被扫描的节点IP等信息，从而获得目标节点扫描结果。
2. 一个IP节点只发送一个探测包：经发送不同数目的探测包试验，发送一个探测包能保证97.9％的探测率；同时ZMAP异步的延时8秒接收方式，能保证99.9%的探测回应包被接收，因此极大提高了探测效率。
3. 分布式乱序探测：为避免传统的顺序IP探测对目标网段造成Flood攻击，利用了数论中的乘法群概念，即将节点IP乘于某质数并取模，有效的将发送的每个扫描数据包分散于不同网段中。
4. 绕过了操作系统协议栈：扫描数据包从以太网帧开始，每次只需改变目的IP和封装了扫描Cookie信息的字段，避免ARP、路由等的查询延时，因此直接绕过协议栈发送数据包，并利用libpcap直接抓取返回的响应数据包。
   
   
   基于以上设计思想，作者实现了ZMAP工具，并与NMAP等进行实测验证了其扫描效果。基于ZMAP的Internet快速扫描功能，作者对Internet进行了进一步的探测，分析了这种快速扫描对Internet安全研究所带来的影响。如，通过扫描443端口获取整个互联网的HTTPS部署情况并分析其证书；发现隐藏网络服务，如tor网络接入点；针对特定漏洞进行全网扫描以发现漏洞节点或分析漏洞修补情；实现botnet的隐蔽通信等。
