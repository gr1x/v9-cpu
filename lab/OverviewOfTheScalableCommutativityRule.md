# 可扩展的变换规则: 为多核设计可扩展的软件

这篇文章针对多核软件中的性能扩展问题，提出了可扩展的交换规则，即软件中部分操作是可交换的，这就意味着从接口层次上来说，这些操作步骤的顺序并不需要进行区分，因此一定存在一种无序冲突检测的接口实现方法。即若接口操作时可变换的，则一定可以以一种可扩展的方式实现这种接口。

例如，getpid()函数在操作系统中就符合可变换规则，因为其值在整个进程周期内都是固定的。但也有部分可交换的系统调用，如两个相同的open("a", O_CREATE|O_EXCL)就不是可交换的，因为一个调用成功、一个失败。然而，如果是两个进程在其当前目录下调用两个的open("a", O_CREATE|O_EXCL)，其结果就是可交换的。

然而，要想人工全面分析一个复杂软件的可交互性是不切实际的，因此，作者也提供了一个Commuter的软件用于分析软件中的可交换性。Commuter分为3个模块，ANALYZER建立接口的符号模型，分析接口的可变换性；第二步，TESTGEN根据前面产生的接口模型，生成具体的操作测试集，根据变换规则，这些测试集应为confilict-free；第三步，MTRACE利用测试集检测接口进行验证。

开发者可以用这些测试集去理解软件中需要实现的可变换规则，迭代修改代码中的可扩展性问题，并确保代码实现中扩展性的bug不会随着时间的推移而出现在应用中。

为了验证COMMUTER效果，作者建议了一些POSIX文件系统和虚拟内存的接口模型，评估了Linux系统的可扩展性，并开放了为作者自己的sv6内核开发了一个可扩展的文件和虚拟内存系统。







